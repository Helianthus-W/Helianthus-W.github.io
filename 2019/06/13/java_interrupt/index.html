<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>java中断机制 | Helianthus</title>
  <meta name="author" content="Helianthus W">

  
  <meta name="description" content="java中线程的状态定义
NEW ： 线程未启动的状态
RUNNABLE ： 线程可运行的状态 处于运行状态的线程在java虚拟机中执行但是它可能会等待来自操作系统的其他资源，比如处理器。
BLOCKED ： 线程阻塞等待获取监控锁的状态 处于阻塞状态的线程正在等待监控锁用于进入同步代码块/同步方法">
  

  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="java中断机制">
  <meta property="og:site_name" content="Helianthus">

  
  

  
    <meta property="og:image" content>
  

  
  <link href="/css/images/favicon.ico" rel="icon">
  

  <link rel="alternate" href="/atom.xml" title="Helianthus" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  


  <!-- baidu webmaster push -->
  <script src="//push.zhanzhang.baidu.com/push.js"></script>

</head>
</html>

<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Helianthus</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2019-06-13T08:49:06.775Z"><a href="/2019/06/13/java_interrupt/">2019-06-13</a></time>
      
      
  
    <h1 class="title">java中断机制</h1>
  

    </header>
    <div class="entry">
      
        <h4 id="java中线程的状态定义"><a href="#java中线程的状态定义" class="headerlink" title="java中线程的状态定义"></a>java中线程的状态定义</h4><ol>
<li>NEW ： 线程未启动的状态</li>
<li>RUNNABLE ： 线程可运行的状态<br> 处于运行状态的线程在java虚拟机中执行但是它可能会等待来自操作系统的其他资源，比如处理器。</li>
<li>BLOCKED ： 线程阻塞等待获取监控锁的状态<br> 处于阻塞状态的线程正在等待监控锁用于进入同步代码块/同步方法或者是被调用后重入同步代码块/同步方法</li>
<li>WAITING ： 线程等待的状态<br> 调用如下方法时线程会进入等待状态：<ul>
<li>Object.wait</li>
<li>Thread.join</li>
<li>LockSupport.part<br>处于等待状态的线程是在等待另一个线程的特定的操作。例如，一个线程调用了一个对象的Object.wait就在等待另一个线程调用该对象的<br>Object.notify或者是Object.notifyAll。一个线程调用了Thread.join在等待一个特定线程的终止。</li>
</ul>
</li>
<li>TIMED_WAITING ： 带有特定等待时间的线程的等待状态<br> 通过调用带有一个合法的等待时间的如下方法会使线程进入特定等待时间的等待状态：<ul>
<li>Thread.sleep</li>
<li>Object.wait</li>
<li>Thread.join</li>
<li>LockSupport.parkNanos</li>
<li>LockSupport.parkUntil</li>
</ul>
</li>
<li><p>TERMINATED ： 线程的终止状态<br> 线程执行结束的状态</p>
<p> 在java中没有提供一种安全直接的方法来停止某个线程，但是java提供了中断机制。</p>
</li>
</ol>
<h4 id="java中断原理"><a href="#java中断原理" class="headerlink" title="java中断原理"></a>java中断原理</h4><pre><code>java中断机制是一种协作机制，也就是说通过中断并不能直接终止另一个线程，而需要被中断的线程自己处理。(被中断的线程并不会立马退出运行)

在java中断模型中，每个线程对象里都有一个boolean类型的标识代表着是否有中断请求。例如，在Thread1想要中断Thread2，只需要在
Thread1中将Thread2的中断标识符设置为true，然后Thread2可以选择在合适的时候处理该中断请求，甚至可以不理会该请求，就像线程没有被中断一样。
</code></pre><h4 id="中断的处理"><a href="#中断的处理" class="headerlink" title="中断的处理"></a>中断的处理</h4><blockquote>
<p>处理时机</p>
</blockquote>
<pre><code>作为一种协作机制，java不会强求被中断线程一定要在某个点进行处理。实际上，被中断线程只需要在合适的时候处理即可，如果没有合适的时间点，甚至可以不处理，这时候在任务处理层面，就跟没有调用中断方法一样。“合适的时候”与线程正在处理的业务逻辑紧密相关。例如，每次迭代的时候，进入一个可能阻塞且无法中断的方法之前等，但是多半不会出现在某一临界区更新另一个对象状态的时候，因为这可能会导致对象处于不一致的状态。

处理时机决定着程序的效率与中断响应的灵敏性。频繁的检查中断状态可能会使程序执行效率下降，相反，检查的较少可能会使中断请求得不到及时响应。如果发出中断请求后，被中断的请求执行一段时间不会给系统带来灾难，那么就可以将中断处理放到方便检查中断，同时又能从一定程度上保证响应灵敏程度的地方。当程序的性能指标比较关键时，可能需要建立一个测试模型来分析最佳的中断检测点，以平衡性能和响应灵敏性。
</code></pre><blockquote>
<p>处理方式</p>
</blockquote>
<ol>
<li><p>中断状态的管理</p>
<p> 一般来说，当可能阻塞的方法声明中有抛出InterruptedException则暗示该方法是可中断的，如果程序捕获到这些可中断的阻塞方法抛出的<br> InterruptedException或检测到中断后，一般有以下两个通用处理原则：</p>
<ol>
<li>如果遇到的是可中断的阻塞方法抛出InterruptedException，可以继续向方法调用栈的上层抛出该异常，如果是检测到中断，则可清除中断状态并抛出InterruptedException，是当前方法也成为一个可中断的方法。</li>
<li>若有时候不方便在方法上抛出InterruptedException，比如要实现的某个接口中的方法签名上没有throws InterruptedException，这时候就可以捕获可中断方法的InterruptedException并通过Thread.currentThread.interrupt()来重新设置中断状态。如果是检测并清除了中断状态，也是如此。</li>
</ol>
</li>
<li><p>中断响应</p>
<p> 程序中发现中断的响应应视情况而定。有些程序可能一检测到中断就立马将线程终止，有些可能是退出当前执行的任务，继续执行下一个任务。作为一种协作机制，这要与中断方协商好，当调用interrupt会发生些什么事情是事先知道的，如做一些事务回滚操作，一些清理工作，一些补偿操作等，如果不确定调用某个线程的interrupt后该线程会作出什么样的响应，那么就不应当中断该线程。</p>
</li>
</ol>
<h4 id="中断的使用"><a href="#中断的使用" class="headerlink" title="中断的使用"></a>中断的使用</h4><pre><code>通常中断的使用场景有以下几个：
</code></pre><ol>
<li>点击桌面应用中的取消按钮时</li>
<li>某个操作超过了一定的执行时间限制需要终止时 </li>
<li>多个线程多相同的事情，只要一个线程成功其他线程都可以取消时</li>
<li>一组线程中的一个或者多个出现错误导致整组都无法继续时</li>
<li>当一个应用或服务需要停止时</li>
</ol>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="javascript:void(0)" class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
        
        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/2019/06/13/杂记/"></a>
      </li>
    
      <li>
        <a href="/2019/06/13/关于java的反射和内省/">java反射和内省</a>
      </li>
    
      <li>
        <a href="/2019/06/13/Spring Doc_01/"></a>
      </li>
    
      <li>
        <a href="/2019/06/13/RabbitMQ_02/">RabbitMQ 配置</a>
      </li>
    
      <li>
        <a href="/2019/06/13/RabbitMQ_01/">Rabbit MQ 使用记录(一)</a>
      </li>
    
  </ul>
</div>


  

  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  <p>
  
  &copy; 2019 Helianthus W
  
  All rights reserved.</p>
  <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</div>
<div class="clearfix"></div>

<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id="bg"></div>
</body>
</html>